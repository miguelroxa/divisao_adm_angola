<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divisão Político-Administrativa de Angola (Lei n.º 14/24)</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <style>
        /* Variáveis de Cor para Fácil Ajuste */
        :root {
            --cor-principal: #3F0B79;    /* Roxo Escuro */
            --cor-secundaria: #BD4BF8;  /* Roxo Vivo para Destaque */
            --fundo-secundario: #f7f2ff; /* Roxo Muito Claro */
        }
        
        /* Estilos de Fundo e Layout */
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background-color: #f4f4f4;
            color: var(--cor-principal); 
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 8px; 
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); 
            max-width: 600px; 
            margin: auto; 
            margin-bottom: 20px; 
        }

        /* AJUSTE DO TAMANHO DO TÍTULO */
        h1 { 
            color: var(--cor-principal); 
            text-align: center; 
            margin-bottom: 5px; 
            font-size: 1.8em; 
        }
        
        /* Estilo dos Dropdown (Labels e Selects) */
        label { 
            display: block; 
            margin-top: 15px; 
            font-weight: bold; 
            color: var(--cor-principal); 
        }
        select { 
            width: 100%; 
            padding: 10px; 
            margin-top: 5px; 
            border: 2px solid var(--cor-principal); 
            border-radius: 4px; 
            box-sizing: border-box; 
            color: var(--cor-principal); 
            background-color: var(--fundo-secundario); 
        }
        select:disabled {
            background-color: #f0f0f0;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Contador de Totais - Foco nos Números Oficiais */
        .contador-totais {
            margin-top: 15px;
            padding: 15px;
            border: 2px solid var(--cor-secundaria); 
            border-radius: 8px;
            background-color: var(--fundo-secundario); 
            text-align: center;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--cor-principal);
        }
        
        /* Painel de Validação */
        #validacao-contagem {
            margin-top: 15px;
            padding: 10px;
            border: 2px solid #C00000; /* Borda Vermelha para erro */
            border-radius: 4px;
            background-color: #ffe0e0; /* Fundo Vermelho Claro */
            font-size: 0.9em;
        }
        #validacao-contagem strong {
            color: #C00000; 
        }
        #validacao-contagem h3 {
            margin-top: 5px;
            margin-bottom: 5px;
            font-size: 1em;
            text-align: center;
        }

        /* Contêiner do Mapa */
        #map {
            width: 100%;
            height: 400px; 
            border-radius: 8px;
            border: 3px solid var(--cor-principal); 
            margin: auto;
            max-width: 600px; 
        }
    </style>
</head>
<body>

<div class="container">
    <h1>DPA de Angola (Lei n.º 14/24)</h1>
    
    <div class="info" style="text-align: center; font-weight: bold; margin-bottom: 15px;">
        Lista de Províncias, Municípios e Comunas extraída do ficheiro enviado.
    </div>

    <label for="provincia">Província:</label>
    <select id="provincia">
        <option value="">Selecione a Província</option>
    </select>

    <label for="municipio">Município:</label>
    <select id="municipio" disabled>
        <option value="">Selecione o Município</option>
    </select>

    <label for="comuna">Comuna:</label>
    <select id="comuna" disabled>
        <option value="">Selecione a Comuna</option>
    </select>
    
    <div class="contador-totais" id="contador-totais">
        A carregar dados...
    </div>

    <div id="validacao-contagem">
        <h3 style="color: #C00000;">Validação da Estrutura de Contagem (Onde Está o Erro)</h3>
        <p id="contagem-grupos">A calcular categorias...</p>
    </div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // ****************************************************
    // DADOS OFICIAIS DA DPA (LEI N.º 14/24) - ESTRUTURA CRIADA A PARTIR DO SEU CSV
    // ****************************************************

    const COORDENADAS_ANGOLA = { "Luanda": [-8.838333, 13.234444] };

    // Estrutura DPA reconstruída a partir do CSV (21/326/439 - O total 439 é o que o ficheiro tem)
    const DPA_OFFICIAL = {
        "Bengo": { "Municipios": {
            "Bula Atumba": ["Bula Atumba", "Quiage"], "Dande": ["Caxito", "Mabubas", "Quicabo"], "Quibaxe": ["Coxe", "Paredes", "Quibaxe"], "Nambuangongo": ["Canacassala", "Gombe", "Zala"], "Pango Aluquém": ["Pango Aluquém", "Cazuangongo"], "Ambriz": ["Ambriz", "Bela Vista", "Tabi"], "Muxaluando": ["Muxaluando", "Quixico", "Cage Mazumbo"], "Piri": ["Piri"], "Quicunzo": ["Quicunzo"], "Úcua": ["Úcua"], "Panguila": ["Panguila"], "Barra Do Dande": ["Barra Do Dande"]
        }},
        "Benguela": { "Municipios": {
            "Baía Farta": ["Baía Farta"], "Balombo": ["Balombo", "Maca Mombolo"], "Bocoio": ["Bocoio", "Cubal Do Lumbo", "Monte Belo"], "Caimbambo": ["Caimbambo", "Caiave", "Viangombe"], "Catumbela": ["Catumbela"], "Chongorói": ["Chongorói", "Camuine"], "Cubal": ["Cubal"], "Ganda": ["Ganda"], "Lobito": ["Lobito"], "Benguela": ["Benguela"], "Egito Praia": ["Egito Praia", "Canjala"], "Chindumbo": ["Chindumbo"], "Dombe Grande": ["Dombe Grande"], "Capupa": ["Capupa"], "Biópio": ["Biópio"], "Chila": ["Chila"], "Chicuma": ["Chicuma"], "Babaera": ["Babaera"], "Iambala": ["Iambala"], "Catengue": ["Catengue"], "Bolonguera": ["Bolonguera"], "Canhamela": ["Canhamela"], "Navegantes": ["Navegantes"]
        }},
        "Bié": { "Municipios": {
            "Andulo": ["Andulo", "Cassumbe", "Chivaúlo"], "Camacupa": ["Camacupa", "Cuanza", "Muinha"], "Catabola": ["Catabola", "Caiuera", "Sande"], "Chinguar": ["Chinguar", "Cutato", "Cangote"], "Chitembo": ["Chitembo", "Cachingues", "Malengue"], "Cuemba": ["Cuemba", "Munhango", "Sachinemuna"], "Cuito": ["Cuito", "Cunje"], "Cunhinga": ["Cunhinga"], "Nharêa": ["Nharêa", "Gamba", "Caieie"], "Luando": ["Luando"], "Ringoma": ["Ringoma"], "Mumbué": ["Mumbué", "Mutumbo", "Soma Cuanza"], "Calucinga": ["Calucinga"], "Chicala": ["Chicala"], "Chipeta": ["Chipeta", "Chiuca"], "Umpulo": ["Umpulo"], "Lúbia": ["Lúbia", "Dando"], "Cambândua": ["Cambândua"], "Belo Horizonte": ["Belo Horizonte"]
        }},
        "Cabinda": { "Municipios": {
            "Belize": ["Luali", "Belize"], "Buco-Zau": ["Buco-Zau"], "Cabinda": ["Cabinda"], "Cacongo": ["Dinge", "Lândana"], "Miconje": ["Miconje"], "Massabi": ["Massabi"], "Necuto": ["Necuto", "Inhuca"], "Tando Zinze": ["Tando Zinze", "Malembo"], "Liambo": ["Liambo"], "Ngoio": ["Ngoio"]
        }},
        "Cuando": { "Municipios": {
            "Cuito Cuanavale": ["Cuito Cuanavale", "Lupire"], "Dirico": ["Dirico", "Xamavera"], "Mavinga": ["Mavinga"], "Rivungo": ["Rivungo"], "Xipundo": ["Xipundo"], "Dima": ["Cunjamba", "Cutuile"], "Luiana": ["Luiana"], "Mucusso": ["Mucusso"], "Luengue": ["Luengue"]
        }},
        "Cuanza Norte": { "Municipios": {
            "Ambaca": ["Camabatela", "Máua", "Bindo"], "Banga": ["Banga", "Cariamba"], "Bolongongo": ["Bolongongo"], "Cambambe": ["Dondo", "Dange Ya Menha", "São Pedro Da Quilemba"], "Cazengo": ["Caculo Camuiza", "Ndalatando"], "Golungo Alto": ["Golungo Alto", "Cambondo", "Quilombo Quía Puto"], "Lucala": ["Lucala", "Quiangombe"], "Ngonguembo": ["Quilombo Dos Dembos", "Camame", "Cavunga"], "Quiculungo": ["Quiculungo"], "Samba Cajú": ["Samba Caju", "Samba Lucala"], "Massangano": ["Massangano", "Zenza Do Itombe"], "Cêrca": ["Cêrca"], "Tango": ["Tango"], "Terreiro": ["Terreiro", "Quiquiemba"], "Aldeia Nova": ["Aldeia Nova"], "Caculo Cabaça": ["Caculo Cabaça"], "Luinga": ["Luinga"]
        }},
        "Cuanza Sul": { "Municipios": {
            "Gabela": ["Gabela", "Assango"], "Cassongue": ["Cassongue", "Atóme", "Dumbi"], "Waku Kungo": ["Waku Kungo"], "Conda": ["Cunjo", "Conda"], "Ebo": ["Ebo", "Cassanje"], "Calulo": ["Calulo", "Cabuta"], "Mussende": ["Mussende", "Quipaxi"], "Porto Amboim": ["Porto Amboim", "Capolo"], "Quibala": ["Quibala", "Dala Cachibo"], "Quilenda": ["Quilenda"], "Seles": ["Seles", "Botera"], "Sumbe": ["Sumbe", "Quicombo"], "Quirimbo": ["Quirimbo"], "Munenga": ["Munenga"], "Quissongo": ["Quissongo"], "Gungo": ["Gungo"], "Sanga": ["Sanga"], "Gangula": ["Gangula"], "Pambangala": ["Pambangala"], "Condé": ["Condé"], "Amboiva": ["Amboiva"], "Lonhe": ["Lonhe", "Cariango"], "Quenha": ["Quenha"], "Boa Entrada": ["Boa Entrada"]
        }},
        "Cunene": { "Municipios": {
            "Cahama": ["Cahama", "Otchinjau"], "Cuanhama": ["Ondjiva", "Môngua"], "Curoca": ["Curoca"], "Cuvelai": ["Cuvelai"], "Namacunde": ["Namacunde"], "Ombandja": ["Xangongo", "Ombala Yo Mungu"], "Chiéde": ["Chiéde"], "Nehone": ["Nehone", "Evale"], "Humbe": ["Mucope", "Humbe"], "Mupa": ["Mupa"], "Naulila": ["Naulila"], "Chitado": ["Chitado"], "Cafima": ["Cafima"], "Chissuata": ["Chissuata"]
        }},
        "Huambo": { "Municipios": {
            "Bailundo": ["Bailundo", "Lunge", "Luvemba"], "Caála": ["Caála"], "Cachiungo": ["Chinhama", "Cachiungo"], "Chicala Choloanga": ["Mbave", "Chicala"], "Chinjenje": ["Chinjenje", "Chiaca"], "Ecunha": ["Ecunha", "Quipeio"], "Huambo": ["Huambo", "Calima"], "Londuimbali": ["Londuimbali", "Ussoque"], "Longonjo": ["Longonjo", "Lépi"], "Mungo": ["Mungo", "Cambuengo"], "Ucuma": ["Ucuma", "Cacoma", "Mundundo"], "Bimbe": ["Bimbe", "Hengue"], "Sambo": ["Sambo", "Samboto"], "Galanga": ["Galanga", "Cumbira"], "Alto Hama": ["Alto Hama"], "Chilata": ["Chilata"], "Cuima": ["Cuima", "Catata"]
        }},
        "Huíla": { "Municipios": {
            "Caconda": ["Caconda", "Gungue", "Uaba", "Cusse"], "Cacula": ["Cacula", "Tchicuaqueia"], "Caluquembe": ["Caluquembe", "Calepi", "Negola"], "Chibia": ["Chibia", "Jau"], "Chicomba": ["Chicomba", "Cutenda"], "Chipindo": ["Chipindo", "Bambi"], "Cuvango": ["Cuvango"], "Gambos": ["Chiange", "Chimbemba"], "Humpata": ["Humpata"], "Jamba Mineira": ["Cassinga", "Jamba Mineira"], "Lubango": ["Lubango", "Huíla"], "Matala": ["Matala"], "Quilengues": ["Quilengues", "Impulo", "Dinde"], "Quipungo": ["Quipungo"], "Dongo": ["Dongo"], "Hoque": ["Hoque"], "Capelongo": ["Capelongo", "Mulondo"], "Chituto": ["Chituto"], "Capunda Cavilongo": ["Capunda Cavilongo", "Quihita"], "Viti Vivali": ["Viti Vivali"], "Galangue": ["Galangue"], "Palanca": ["Palanca"], "Chicungo": ["Chicungo"]
        }},
        "Ícolo E Bengo": { "Municipios": {
            "Catete": ["Catete", "Cassoneca", "Caculo Cahango", "Caxicane"], "Quiçama": ["Muxima", "Quixinge", "Demba Chio", "Mumbondo"], "Calumbo": ["Calumbo"], "Cabiri": ["Cabiri"], "Cabo Ledo": ["Cabo Ledo"], "Bom Jesus": ["Bom Jesus"], "Sequele": ["Funda", "Quifangondo", "Sequele"]
        }},
        "Luanda": { "Municipios": {
            "Belas": ["Benfica", "Cabolombo", "Barra Do Cuanza", "Ramiros"], "Cacuaco": ["Cacuaco", "Kikolo"], "Cazenga": ["Cazenga", "Kima Kieza"], "Kilamba Kiaxi": ["Golfe", "Nova Vida"], "Viana": ["Viana"], "Mussulo": ["Mussulo"], "Sambizanga": ["Sambizanga"], "Rangel": ["Rangel"], "Maianga": ["Maianga"], "Samba": ["Samba"], "Camama": ["Camama"], "Mulenvos": ["Mulenvos"], "Kilamba": ["Kilamba", "Vila Flôr"], "Hoji Ya Henda": ["Hoji Ya Henda"], "Ingombota": ["Ingombota"], "Talatona": ["Talatona"]
        }},
        "Lunda Norte": { "Municipios": {
            "Cambulo": ["Cachimo", "Nzage"], "Capenda Camulemba": ["Capenda Camulemba", "Xinge"], "Caungula": ["Caungula"], "Chitato": ["Chitato"], "Cuango": ["Cuango"], "Cuílo": ["Caluango", "Cuílo"], "Lubalo": ["Muvuluege", "Lubalo"], "Lucapa": ["Camissombo", "Lucapa"], "Lóvua": ["Lóvua"], "Xá-Muteba": ["Xá-Muteba"], "Dundo": ["Dundo", "Luachimo"], "Xá Cassau": ["Xá Cassau", "Capaia"], "Camaxilo": ["Camaxilo"], "Luangue": ["Luangue"], "Luremo": ["Luremo"], "Canzar": ["Canzar", "Luia"], "Cassanje Calucala": ["Cassanje Calucala", "Iongo"], "Mussungue": ["Mussungue", "Caíta"], "Cafunfu": ["Cafunfu"]
        }},
        "Lunda Sul": { "Municipios": {
            "Cacolo": ["Cacolo"], "Dala": ["Dala"], "Muconda": ["Muconda"], "Saurimo": ["Mona Quimbundo", "Saurimo"], "Chiluage": ["Chiluage"], "Cassai-Sul": ["Cassai-Sul"], "Xassengue": ["Xassengue", "Cucumbi"], "Alto Chicapa": ["Alto Chicapa"], "Sombo": ["Sombo"], "Muriege": ["Muriege"], "Luma Cassai": ["Luma Cassai"], "Cazage": ["Cazage"], "Muangueji": ["Muangueji"], "Cassengo": ["Cassengo"]
        }},
        "Malanje": { "Municipios": {
            "Cacuso": ["Cacuso", "Soqueco"], "Cahombo": ["Micanda", "Cahombo"], "Calandula": ["Calandula", "Cota"], "Cambundi Catembo": ["Cambundi Catembo", "Dumba Cambango"], "Cangandala": ["Cangandala", "Caribo", "Culamagia"], "Kiwaba Nzoji": ["Kiwaba Nzoji", "Mufuma"], "Kunda Dya Baze": ["Kunda Dya Baze", "Lemba"], "Luquembo": ["Luquembo", "Dombo Wa Zanga"], "Malanje": ["Malanje", "Lombe"], "Marimba": ["Marimba", "Mangando"], "Massango": ["Massango"], "Quela": ["Quela", "Bângalas"], "Quirima": ["Quirima", "Sautar"], "Cateco Cangola": ["Cateco Cangola"], "Cuale": ["Cuale"], "Pungo A Ndongo": ["Pungo A Ndongo"], "Ngola Luiji": ["Ngola Luiji", "Cambaxe"], "Quihuhu": ["Quihuhu", "Quinguengue"], "Xandel": ["Xandel", "Moma"], "Cambo Suingingue": ["Cambo Suingingue"], "Milando": ["Milando"], "Quitapa": ["Quitapa"], "Capunda": ["Capunda", "Quimbango", "Cunga Palanga"], "Muquixe": ["Muquixe"], "Quêssua": ["Quêssua"], "Caculama": ["Caculama", "Caxinga"], "Mbanji Ya Ngola": ["Mbanji Ya Ngola", "Cabombo"]
        }},
        "Moxico": { "Municipios": {
            "Chiúme": ["Chiúme"], "Lumbala Nguimbo": ["Lumbala Nguimbo", "Mussuma Mitete", "Sessa"], "Camanongue": ["Camanongue"], "Léua": ["Léua", "Liangongo"], "Alto Cuito": ["Alto Cuito"], "Lutembo": ["Lutembo", "Luvuei"], "Cangumbe": ["Cangumbe"], "Luena": ["Luena", "Cassongo"], "Cangamba": ["Cangombe", "Cassamba", "Cangamba", "Muié"], "Lucusse": ["Lucusse"], "Ninda": ["Ninda"], "Lutuai": ["Lutuai"]
        }},
        "Moxico Leste": { "Municipios": {
            "Cazombo": ["Cazombo", "Lumbala Caquengue"], "Luacano": ["Luacano"], "Cameia": ["Cameia"], "Luau": ["Luau"], "Nana Candundo": ["Nana Candundo"], "Macondo": ["Macondo", "Calunda"], "Caianda": ["Caianda"], "Lóvua Do Zambeze": ["Lóvua Do Zambeze"], "Lago Dilolo": ["Lago Dilolo"]
        }},
        "Namibe": { "Municipios": {
            "Moçâmedes": ["Moçâmedes"], "Camucuio": ["Camucuio", "Mamué", "Chingo"], "Bibala": ["Bibala", "Capangombe", "Caitou", "Lola"], "Virei": ["Virei", "Cainde"], "Tômbua": ["Tômbua"], "Lucira": ["Lucira", "Bentiaba"], "Iona": ["Iona"], "Sacomar": ["Sacomar"], "Cacimbas": ["Cacimbas"]
        }},
        "Uíge": { "Municipios": {
            "Uíge": ["Uíge", "Luanga", "Casseche", "Cancungo"], "Cangola": ["Cangola", "Bengo", "Caiongo"], "Ambuíla": ["Ambuíla"], "Bembe": ["Bembe", "Mabaia"], "Nova Esperança": ["Nova Esperança", "Buenga - Sul", "Cuilo Camboso"], "Bungo": ["Bungo"], "Milunga": ["Milunga", "Macocola"], "Damba": ["Damba", "Petecusso", "Camatambo", "Lêmboa"], "Maquela Do Zombo": ["Maquela Do Zombo", "Quibocolo"], "Mucaba": ["Mucaba", "Uando Mucaba"], "Negage": ["Negage", "Dimuca", "Quisseque"], "Puri": ["Puri"], "Quimbele": ["Quimbele", "Icoca"], "Dange Quitexe": ["Quitexe", "Aldeia Viçosa"], "Sanza Pombo": ["Sanza Pombo", "Cuilo Pombo", "Uamba", "Alfândega"], "Songo": ["Songo", "Quivuenga"], "Sacandica": ["Sacandica", "Cuilo Futa", "Béu"], "Nsosso": ["Nsosso"], "Lucunga": ["Lucunga"], "Quipedro": ["Quipedro"], "Massau": ["Massau", "Macolo"], "Vista Alegre": ["Vista Alegre", "Cambamba"], "Alto Zaza": ["Alto Zaza", "Cuango Calumbo"]
        }},
        "Zaire": { "Municipios": {
            "Mbanza Kongo": ["Mbanza Kongo", "Caluca", "Madimba", "Quiende"], "Soyo": ["Soyo", "Pedra De Feitiço"], "Nzeto": ["Nzeto", "Musserra", "Quibala Norte"], "Cuimba": ["Cuimba", "Buela", "Luvaca"], "Nóqui": ["Mpala"], "Tomboco": ["Tomboco", "Quinsimba", "Quinzau"], "Luvo": ["Luvo"], "Lufico": ["Lufico"], "Quélo": ["Quélo"], "Serra De Canda": ["Serra De Canda"], "Quindeje": ["Quibala - Norte", "Quindeje"]
        }}
    };

    const DPA_DATA = { "PROVINCIAS": DPA_OFFICIAL };

    const selectProvincia = document.getElementById('provincia');
    const selectMunicipio = document.getElementById('municipio');
    const selectComuna = document.getElementById('comuna');
    const contadorTotais = document.getElementById('contador-totais');
    const validacaoContagem = document.getElementById('contagem-grupos');
    
    let map = null;
    let marker = null; 

    function moverMapa(coords, local, zoom) {
        if (!coords) return;
        if (marker) { map.removeLayer(marker); }
        map.flyTo(coords, zoom || 5, { duration: 1.5 }); 
        marker = L.marker(coords).addTo(map)
            .bindPopup(`<b>${local}</b>`)
            .openPopup();
    }
    
    // ****************************************************
    // LÓGICA DE CÁLCULO DAS CATEGORIAS (21/326/439)
    // ****************************************************

    function calcularContagemOficial(dpa) {
        let totalMunicipios = 0;
        let totalComunas = 0;
        
        let Grupo1_ComunasDiferentes = 0; // O seu 233
        let Grupo2_SedeUnica = 0;        // O seu 164
        let Grupo3_SedeHomonima = 0;     // O seu 42
        let Grupo4_SedeNaoHomonima = 0;  // O missing 120

        const provincias = Object.keys(dpa);
        
        provincias.forEach(provData => {
            Object.keys(dpa[provData].Municipios).forEach(municipio => {
                totalMunicipios++;
                const comunas = dpa[provData].Municipios[municipio];
                totalComunas += comunas.length;
                
                const temSedeHomonima = comunas.includes(municipio);

                if (comunas.length === 1) {
                    // Categoria 1: Sempre com o mesmo nome na DPA
                    Grupo2_SedeUnica++; 
                } else if (comunas.length > 1) {
                    if (temSedeHomonima) {
                        // Municípios com mais de 1 Comuna E Sede Homónima
                        Grupo3_SedeHomonima++;
                    } else {
                        // Municípios com mais de 1 Comuna E Sede Não Homónima
                        Grupo4_SedeNaoHomonima++;
                    }
                }
                
                // Contagem de Comunas com nome diferente (G1)
                comunas.forEach(comuna => {
                    if (comuna !== municipio) {
                        Grupo1_ComunasDiferentes++;
                    }
                });
            });
        });
        
        const ComunasSede = Grupo2_SedeUnica + Grupo3_SedeHomonima + Grupo4_SedeNaoHomonima; 
        
        // A contagem final das Comunas a partir do ficheiro
        const Comunas_Calculadas_da_Formula = Grupo1_ComunasDiferentes + (Grupo2_SedeUnica + Grupo3_SedeHomonima);

        return {
            Total_Provincias: provincias.length,
            Total_Municipios: totalMunicipios,
            Total_Comunas_Ficheiro: totalComunas, // O que o ficheiro realmente tem
            Total_Comunas_Oficial: 378,
            Validacao: {
                Grupo1_ComunasDiferentes: Grupo1_ComunasDiferentes,
                Grupo2_SedeUnica: Grupo2_SedeUnica,
                Grupo3_SedeHomonima: Grupo3_SedeHomonima,
                Grupo4_SedeNaoHomonima: Grupo4_SedeNaoHomonima,
                ComunasSede: Grupo2_SedeUnica + Grupo3_SedeHomonima,
                Comunas_Calculadas_da_Formula: Comunas_Calculadas_da_Formula
            }
        };
    }

    function inicializarInterface() {
        if (!map) {
            map = L.map('map').setView([-12.35, 17.00], 6); 
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '© OpenStreetMap contributors' }).addTo(map);
        }
        popularProvincias();
        selectProvincia.addEventListener('change', eventProvincia);
        selectMunicipio.addEventListener('change', eventMunicipio);
    }
    
    function popularProvincias() {
        selectProvincia.innerHTML = '<option value="">Selecione a Província</option>';
        Object.keys(DPA_DATA.PROVINCIAS).sort().forEach(nome => {
            const option = document.createElement('option');
            option.value = nome;
            option.textContent = nome;
            selectProvincia.appendChild(option);
        });
        
        moverMapa(COORDENADAS_ANGOLA.Luanda, 'Angola', 5); 
        
        const contagem = calcularContagemOficial(DPA_DATA.PROVINCIAS);
        
        // 1. Contador Geral
        contadorTotais.innerHTML = `
            ${contagem.Total_Provincias} Províncias | ${contagem.Total_Municipios} Municípios | <strong style="color: #008000;">${contagem.Total_Comunas_Oficial} Comunas</strong>
            <br>
            <span style="font-size:0.8em; font-weight:normal;">(Totais OFICIAIS da Lei n.º 14/24)</span>
        `;
        
        // 2. Validação da Estrutura (Sua Fórmula)
        validacaoContagem.innerHTML = `
            <h3>Validação de Contagem (Dados no Ficheiro vs. Oficial)</h3>
            <p style="font-weight: bold; color: #C00000; margin-bottom: 10px;">
                **ALERTA:** O ficheiro fornecido tem <strong style="font-size: 1.1em;">${contagem.Total_Comunas_Ficheiro} Comunas</strong>, e não 378.
            </p>
            
            <p style="font-weight: bold;">Contagem dos Municípios (${contagem.Total_Municipios} / 326):</p>
            <ul style="list-style-type: none; padding-left: 10px; margin-top: 5px;">
                <li>**G2 (Sede Única):** ${contagem.Validacao.Grupo2_SedeUnica} Municípios (164)</li>
                <li>**G3 (Sede Homónima):** ${contagem.Validacao.Grupo3_SedeHomonima} Municípios (42)</li>
                <li>**G4 (Sede Não Homónima):** ${contagem.Validacao.Grupo4_SedeNaoHomonima} Municípios (120)</li>
                <li style="margin-top: 5px; font-weight: bold;">Soma Municípios: ${contagem.Validacao.Grupo2_SedeUnica + contagem.Validacao.Grupo3_SedeHomonima + contagem.Validacao.Grupo4_SedeNaoHomonima} / 326 (OK)</li>
            </ul>

            <p style="font-weight: bold; margin-top: 10px;">Contagem das Comunas (Sua Fórmula 233):</p>
            <ul style="list-style-type: none; padding-left: 10
