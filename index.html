<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divisão Politico-Administrativa de Angola (21 Províncias - Lei n.º 14/24)</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>

    <style>
        /* Cores solicitadas */
        :root {
            --cor-principal: #3F0B79; /* Roxo Escuro */
            --cor-secundaria: #BD4BF8; /* Roxo Claro / Destaque */
            --cor-fundo: #f0f0f5;
        }

        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background-color: var(--cor-fundo);
            color: var(--cor-principal); 
        }
        .container { 
            background: white; 
            padding: 40px; 
            border-radius: 12px; 
            box-shadow: 0 4px 4px rgba(0, 0, 0, 0.1); 
            max-width: 800px; 
            margin: auto; 
            margin-bottom: 20px;
        }
        h1 { 
            color: var(--cor-principal); 
            text-align: center; 
            margin-bottom: 5px; 
            font-size: 1.8em; 
            border-bottom: 3px solid var(--cor-secundaria);
            padding-bottom: 10px;
        }
        .lei-ref {
            text-align: center;
            font-size: 1.1em;
            color: var(--cor-secundaria);
            font-weight: bold;
            margin-bottom: 25px;
        }
        label { 
            display: block; 
            margin-top: 20px; 
            font-weight: bold; 
            color: var(--cor-principal); 
            font-size: 1.1em;
        }
        select { 
            width: 100%; 
            padding: 12px; 
            margin-top: 8px; 
            border: 2px solid var(--cor-principal); 
            border-radius: 6px; 
            box-sizing: border-box; 
            color: var(--cor-principal); 
            background-color: #fff;
            font-size: 1em;
        }
        .status-box {
            margin-top: 30px;
            padding: 20px;
            border: 2px solid var(--cor-secundaria); 
            border-radius: 8px;
            background-color: #f7e6ff;
        }
        .status-box p {
            margin: 8px 0;
            font-size: 1.1em;
            line-height: 1.5;
        }
        .capital {
            color: var(--cor-secundaria);
            font-weight: bold;
        }
        #map {
            height: 450px; 
            width: 100%;
            margin-top: 20px;
            border: 3px solid var(--cor-principal); 
            border-radius: 8px;
        }
        .map-title {
            text-align: center;
            font-size: 1.2em;
            color: var(--cor-principal);
            font-weight: bold;
            margin-top: 40px;
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px solid var(--cor-secundaria);
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Divisão Politico-Administrativa de Angola</h1>
    <div class="lei-ref">
        (Lei n.º 14/24 de 5 de Setembro: **21 Províncias**)
    </div>

    <label for="provincia">Selecione a Província:</label>
    <select id="provincia">
        <option value="">A Carregar...</option>
    </select>

    <label for="municipio">Município:</label>
    <select id="municipio" disabled>
        <option value="">Selecione o Município</option>
    </select>

    <label for="comuna">Comuna:</label>
    <select id="comuna" disabled>
        <option value="">Selecione a Comuna</option>
    </select>
    
    <div class="status-box" id="status-display">
        <p>Selecione uma **Província** no menu acima.</p>
    </div>
    
    <div class="map-title">Localização Geográfica (Zoom por Capital)</div>
    <div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
integrity="sha256-2Pmvv0kuTBOzK08F8g4M1zQwsiniH58/2oYTrpMQAQY="
crossorigin=""></script>

<script>
    // Função utilitária para formatar para Title Case (Maiúscula na Primeira Letra de cada palavra)
    function toTitleCase(str) {
        if (!str) return str;
        // Divide por espaço e hífens para tratar nomes como "Moxico Leste" e "Bela Vista"
        return str.toLowerCase().split(/[\s-]/).map(function(word) {
            if (word.length === 0) return word;
            return word.charAt(0).toUpperCase() + word.slice(1);
        }).join(' ');
    }
    
    // ****************************************************
    // DADOS DPA (21 Províncias) - CORREÇÃO FINAL MBANZA CONGO
    // ****************************************************
    const DPA_JSON_STRING = `{
        "Bengo": { "Municipios": {
            "Bula Atumba": ["Bula Atumba", "Quiage"], "Dande": ["Caxito", "Mabubas", "Quicabo"], "Quibaxe": ["Coxe", "Paredes", "Quibaxe"], "Nambuangongo": ["Canacassala", "Gombe", "Zala"], "Pango Aluquém": ["Pango Aluquém", "Cazuangongo"], "Ambriz": ["Ambriz", "Bela Vista", "Tabi"], "Muxaluando": ["Muxaluando", "Quixico", "Cage Mazumbo"], "Piri": ["Piri"], "Quicunzo": ["Quicunzo"], "Úcua": ["Úcua"], "Panguila": ["Panguila"], "Barra Do Dande": ["Barra Do Dande"]
        }},
        "Benguela": { "Municipios": {
            "Baía Farta": ["Baía Farta"], "Balombo": ["Balombo", "Maca Mombolo"], "Bocoio": ["Bocoio", "Cubal Do Lumbo", "Monte Belo"], "Caimbambo": ["Caimbambo", "Caiave", "Viangombe"], "Catumbela": ["Catumbela"], "Chongorói": ["Chongorói", "Camuine"], "Cubal": ["Cubal"], "Ganda": ["Ganda"], "Lobito": ["Lobito"], "Benguela": ["Benguela"], "Egito Praia": ["Egito Praia", "Canjala"], "Chindumbo": ["Chindumbo"], "Dombe Grande": ["Dombe Grande"], "Capupa": ["Capupa"], "Biópio": ["Biópio"], "Chila": ["Chila"], "Chicuma": ["Chicuma"], "Babaera": ["Babaera"], "Iambala": ["Iambala"], "Catengue": ["Catengue"], "Bolonguera": ["Bolonguera"], "Canhamela": ["Canhamela"], "Navegantes": ["Navegantes"]
        }},
        "Bié": { "Municipios": {
            "Andulo": ["Andulo", "Cassumbe", "Chivaúlo"], "Camacupa": ["Camacupa", "Cuanza", "Muinha"], "Catabola": ["Catabola", "Caiuera", "Sande"], "Chinguar": ["Chinguar", "Cutato", "Cangote"], "Chitembo": ["Chitembo", "Cachingues", "Malengue"], "Cuemba": ["Cuemba", "Munhango", "Sachinemuna"], "Cuito": ["Cuito", "Cunje"], "Cunhinga": ["Cunhinga"], "Nharêa": ["Nharêa", "Gamba", "Caieie"], "Luando": ["Luando"], "Ringoma": ["Ringoma"], "Mumbué": ["Mumbué", "Mutumbo", "Soma Cuanza"], "Calucinga": ["Calucinga"], "Chicala": ["Chicala"], "Chipeta": ["Chipeta", "Chiuca"], "Umpulo": ["Umpulo"], "Lúbia": ["Lúbia", "Dando"], "Cambândua": ["Cambândua"], "Belo Horizonte": ["Belo Horizonte"]
        }},
        "Cabinda": { "Municipios": {
            "Belize": ["Luali", "Belize"], "Buco-Zau": ["Buco-Zau"], "Cabinda": ["Cabinda"], "Cacongo": ["Dinge", "Lândana"], "Miconje": ["Miconje"], "Massabi": ["Massabi"], "Necuto": ["Necuto", "Inhuca"], "Tando Zinze": ["Tando Zinze", "Malembo"], "Liambo": ["Liambo"], "Ngoio": ["Ngoio"]
        }},
        "Cuando": { "Municipios": {
            "Cuito Cuanavale": ["Cuito Cuanavale", "Lupire"], "Dirico": ["Dirico", "Xamavera"], "Mavinga": ["Mavinga"], "Rivungo": ["Rivungo"], "Xipundo": ["Xipundo"], "Dima": ["Cunjamba", "Cutuile"], "Luiana": ["Luiana"], "Mucusso": ["Mucusso"], "Luengue": ["Luengue"]
        }},
        "Cubango": { "Municipios": {
            "Calai": ["Calai"], "Cuangar": ["Cuangar"], "Cuchi": ["Cuchi"], "Cutato": ["Cutato", "Vissati"], "Caiundo": ["Caiundo", "Jamba Cueio"], "Longa": ["Longa", "Baixo Longa"], "Menongue": ["Menongue"], "Nancova": ["Nancova", "Rito"], "Savate": ["Savate", "Bondo Caíla"], "Chinguanja": ["Chinguanja"]
        }},
        "Cuanza Norte": { "Municipios": {
            "Ambaca": ["Camabatela", "Máua", "Bindo"], "Banga": ["Banga", "Cariamba"], "Bolongongo": ["Bolongongo"], "Cambambe": ["Dondo", "Dange Ya Menha", "São Pedro Da Quilemba"], "Cazengo": ["Caculo Camuiza", "Ndalatando"], "Golungo Alto": ["Golungo Alto", "Cambondo", "Quilombo Quía Puto"], "Lucala": ["Lucala", "Quiangombe"], "Ngonguembo": ["Quilombo Dos Dembos", "Camame", "Cavunga"], "Quiculungo": ["Quiculungo"], "Samba Caju": ["Samba Caju", "Samba Lucala"], "Massangano": ["Massangano", "Zenza Do Itombe"], "Cêrca": ["Cêrca"], "Tango": ["Tango"], "Terreiro": ["Terreiro", "Quiquiemba"], "Aldeia Nova": ["Aldeia Nova"], "Caculo Cabaça": ["Caculo Cabaça"], "Luinga": ["Luinga"]
        }},
        "Cuanza Sul": { "Municipios": {
            "Gabela": ["Gabela", "Assango"], "Cassongue": ["Cassongue", "Atóme", "Dumbi"], "Waku Kungo": ["Waku Kungo"], "Conda": ["Cunjo", "Conda"], "Ebo": ["Ebo", "Cassanje"], "Calulo": ["Calulo", "Cabuta"], "Mussende": ["Mussende", "Quipaxi"], "Porto Amboim": ["Porto Amboim", "Capolo"], "Quibala": ["Quibala", "Dala Cachibo"], "Quilenda": ["Quilenda"], "Seles": ["Seles", "Botera"], "Sumbe": ["Sumbe", "Quicombo"], "Quirimbo": ["Quirimbo"], "Munenga": ["Munenga"], "Quissongo": ["Quissongo"], "Gungo": ["Gungo"], "Sanga": ["Sanga"], "Gangula": ["Gangula"], "Pambangala": ["Pambangala"], "Condé": ["Condé"], "Amboiva": ["Amboiva"], "Lonhe": ["Lonhe", "Cariango"], "Quenha": ["Quenha"], "Boa Entrada": ["Boa Entrada"]
        }},
        "Cunene": { "Municipios": {
            "Cahama": ["Cahama", "Otchinjau"], "Cuanhama": ["Ondjiva", "Môngua"], "Curoca": ["Curoca"], "Cuvelai": ["Cuvelai"], "Namacunde": ["Namacunde"], "Ombandja": ["Xangongo", "Ombala Yo Mungu"], "Chiéde": ["Chiéde"], "Nehone": ["Nehone", "Evale"], "Humbe": ["Mucope", "Humbe"], "Mupa": ["Mupa"], "Naulila": ["Naulila"], "Chitado": ["Chitado"], "Cafima": ["Cafima"], "Chissuata": ["Chissuata"]
        }},
        "Huambo": { "Municipios": {
            "Bailundo": ["Bailundo", "Lunge", "Luvemba"], "Caála": ["Caála"], "Cachiungo": ["Chinhama", "Cachiungo"], "Chicala Choloanga": ["Mbave", "Chicala"], "Chinjenje": ["Chinjenje", "Chiaca"], "Ecunha": ["Ecunha", "Quipeio"], "Huambo": ["Huambo", "Calima"], "Londuimbali": ["Londuimbali", "Ussoque"], "Longonjo": ["Longonjo", "Lépi"], "Mungo": ["Mungo", "Cambuengo"], "Ucuma": ["Ucuma", "Cacoma", "Mundundo"], "Bimbe": ["Bimbe", "Hengue"], "Sambo": ["Sambo", "Samboto"], "Galanga": ["Galanga", "Cumbira"], "Alto Hama": ["Alto Hama"], "Chilata": ["Chilata"], "Cuima": ["Cuima", "Catata"]
        }},
        "Huíla": { "Municipios": {
            "Caconda": ["Caconda", "Gungue", "Uaba", "Cusse"], "Cacula": ["Cacula", "Tchicuaqueia"], "Caluquembe": ["Caluquembe", "Calepi", "Negola"], "Chibia": ["Chibia", "Jau"], "Chicomba": ["Chicomba", "Cutenda"], "Chipindo": ["Chipindo", "Bambi"], "Cuvango": ["Cuvango"], "Gambos": ["Chiange", "Chimbemba"], "Humpata": ["Humpata"], "Jamba Mineira": ["Cassinga", "Jamba Mineira"], "Lubango": ["Lubango", "Huíla"], "Matala": ["Matala"], "Quilengues": ["Quilengues", "Impulo", "Dinde"], "Quipungo": ["Quipungo"], "Dongo": ["Dongo"], "Hoque": ["Hoque"], "Capelongo": ["Capelongo", "Mulondo"], "Chituto": ["Chituto"], "Capunda Cavilongo": ["Capunda Cavilongo", "Quihita"], "Viti Vivali": ["Viti Vivali"], "Galangue": ["Galangue"], "Palanca": ["Palanca"], "Chicungo": ["Chicungo"]
        }},
        "Ícolo E Bengo": { "Municipios": {
            "Catete": ["Catete", "Cassoneca", "Caculo Cahango", "Caxicane"], "Quiçama": ["Muxima", "Quixinge", "Demba Chio", "Mumbondo"], "Calumbo": ["Calumbo"], "Cabiri": ["Cabiri"], "Cabo Ledo": ["Cabo Ledo"], "Bom Jesus": ["Bom Jesus"], "Sequele": ["Funda", "Quifangondo", "Sequele"]
        }},
        "Luanda": { "Municipios": {
            "Belas": ["Benfica", "Cabolombo", "Barra Do Cuanza", "Ramiros"], "Cacuaco": ["Cacuaco", "Kikolo"], "Cazenga": ["Cazenga", "Kima Kieza"], "Kilamba Kiaxi": ["Golfe", "Nova Vida"], "Viana": ["Viana"], "Mussulo": ["Mussulo"], "Sambizanga": ["Sambizanga"], "Rangel": ["Rangel"], "Maianga": ["Maianga"], "Samba": ["Samba"], "Camama": ["Camama"], "Mulenvos": ["Mulenvos"], "Kilamba": ["Kilamba", "Vila Flôr"], "Hoji Ya Henda": ["Hoji Ya Henda"], "Ingombota": ["Ingombota"], "Talatona": ["Talatona"]
        }},
        "Lunda Norte": { "Municipios": {
            "Cambulo": ["Cachimo", "Nzage"], "Capenda Camulemba": ["Capenda Camulemba", "Xinge"], "Caungula": ["Caungula"], "Chitato": ["Chitato"], "Cuango": ["Cuango"], "Cuílo": ["Caluango", "Cuílo"], "Lubalo": ["Muvuluege", "Lubalo"], "Lucapa": ["Camissombo", "Lucapa"], "Lóvua": ["Lóvua"], "Xá-Muteba": ["Xá-Muteba"], "Dundo": ["Dundo", "Luachimo"], "Xá Cassau": ["Xá Cassau", "Capaia"], "Camaxilo": ["Camaxilo"], "Luangue": ["Luangue"], "Luremo": ["Luremo"], "Canzar": ["Canzar", "Luia"], "Cassanje Calucala": ["Cassanje Calucala", "Iongo"], "Mussungue": ["Mussungue", "Caíta"], "Cafunfu": ["Cafunfu"]
        }},
        "Lunda Sul": { "Municipios": {
            "Cacolo": ["Cacolo"], "Dala": ["Dala"], "Muconda": ["Muconda"], "Saurimo": ["Mona Quimbundo", "Saurimo"], "Chiluage": ["Chiluage"], "Cassai-Sul": ["Cassai-Sul"], "Xassengue": ["Xassengue", "Cucumbi"], "Alto Chicapa": ["Alto Chicapa"], "Sombo": ["Sombo"], "Muriege": ["Muriege"], "Luma Cassai": ["Luma Cassai"], "Cazage": ["Cazage"], "Muangueji": ["Muangueji"], "Cassengo": ["Cassengo"]
        }},
        "Malanje": { "Municipios": {
            "Cacuso": ["Cacuso", "Soqueco"], "Cahombo": ["Micanda", "Cahombo"], "Calandula": ["Calandula", "Cota"], "Cambundi Catembo": ["Cambundi Catembo", "Dumba Cambango"], "Cangandala": ["Cangandala", "Caribo", "Culamagia"], "Kiwaba Nzoji": ["Kiwaba Nzoji", "Mufuma"], "Kunda Dya Baze": ["Kunda Dya Baze", "Lemba"], "Luquembo": ["Luquembo", "Dombo Wa Zanga"], "Malanje": ["Malanje", "Lombe"], "Marimba": ["Marimba", "Mangando"], "Massango": ["Massango"], "Quela": ["Quela", "Bângalas"], "Quirima": ["Quirima", "Sautar"], "Cateco Cangola": ["Cateco Cangola"], "Cuale": ["Cuale"], "Pungo A Ndongo": ["Pungo A Ndongo"], "Ngola Luiji": ["Ngola Luiji", "Cambaxe"], "Quihuhu": ["Quihuhu", "Quinguengue"], "Xandel": ["Xandel", "Moma"], "Cambo Suingingue": ["Cambo Suingingue", "Milando"], "Quitapa": ["Quitapa"], "Capunda": ["Capunda", "Quimbango", "Cunga Palanga"], "Muquixe": ["Muquixe"], "Quêssua": ["Quêssua"], "Caculama": ["Caculama", "Caxinga"], "Mbanji Ya Ngola": ["Mbanji Ya Ngola", "Cabombo"]
        }},
        "Moxico": { "Municipios": {
            "Chiúme": ["Chiúme"], "Lumbala Nguimbo": ["Lumbala Nguimbo", "Mussuma Mitete", "Sessa"], "Camanongue": ["Camanongue"], "Léua": ["Léua", "Liangongo"], "Alto Cuito": ["Alto Cuito"], "Lutembo": ["Lutembo", "Luvuei"], "Cangumbe": ["Cangumbe"], "Luena": ["Luena", "Cassongo"], "Cangamba": ["Cangombe", "Cassamba", "Cangamba", "Muié"], "Lucusse": ["Lucusse"], "Ninda": ["Ninda"], "Lutuai": ["Lutuai"]
        }},
        "Moxico Leste": { "Municipios": {
            "Cazombo": ["Cazombo", "Lumbala Caquengue"], "Luacano": ["Luacano"], "Cameia": ["Cameia"], "Luau": ["Luau"], "Nana Candundo": ["Nana Candundo"], "Macondo": ["Macondo", "Calunda"], "Caianda": ["Caianda"], "Lóvua Do Zambeze": ["Lóvua Do Zambeze"], "Lago Dilolo": ["Lago Dilolo"]
        }},
        "Namibe": { "Municipios": {
            "Moçâmedes": ["Moçâmedes"], "Camucuio": ["Camucuio", "Mamué", "Chingo"], "Bibala": ["Bibala", "Capangombe", "Caitou", "Lola"], "Virei": ["Virei", "Cainde"], "Tômbua": ["Tômbua"], "Lucira": ["Lucira", "Bentiaba"], "Iona": ["Iona"], "Sacomar": ["Sacomar"], "Cacimbas": ["Cacimbas"]
        }},
        "Uíge": { "Municipios": {
            "Uíge": ["Uíge", "Luanga", "Casseche", "Cancungo"], "Cangola": ["Cangola", "Bengo", "Caiongo"], "Ambuíla": ["Ambuíla"], "Bembe": ["Bembe", "Mabaia"], "Nova Esperança": ["Nova Esperança", "Buenga - Sul", "Cuilo Camboso"], "Bungo": ["Bungo"], "Milunga": ["Milunga", "Macocola"], "Damba": ["Damba", "Petecusso", "Camatambo", "Lêmboa"], "Maquela Do Zombo": ["Maquela Do Zombo", "Quibocolo"], "Mucaba": ["Mucaba", "Uando Mucaba"], "Negage": ["Negage", "Dimuca", "Quisseque"], "Puri": ["Puri"], "Quimbele": ["Quimbele", "Icoca"], "Dange Quitexe": ["Quitexe", "Aldeia Viçosa"], "Sanza Pombo": ["Sanza Pombo", "Cuilo Pombo", "Uamba", "Alfândega"], "Songo": ["Songo", "Quivuenga"], "Sacandica": ["Sacandica", "Cuilo Futa", "Béu"], "Nsosso": ["Nsosso"], "Lucunga": ["Lucunga"], "Quipedro": ["Quipedro"], "Massau": ["Massau", "Macolo"], "Vista Alegre": ["Vista Alegre", "Cambamba"], "Alto Zaza": ["Alto Zaza", "Cuango Calumbo"]
        }},
        "Zaire": { "Municipios": {
            "Mbanza Congo": ["Mbanza Congo", "Caluca", "Madimba", "Quiende"], 
            "Soyo": ["Soyo", "Pedra De Feitiço"], "Nzeto": ["Nzeto", "Musserra", "Quibala Norte"], "Cuimba": ["Cuimba", "Buela", "Luvaca"], "Nóqui": ["Mpala"], "Tomboco": ["Tomboco", "Quinsimba", "Quinzau"], "Luvo": ["Luvo"], "Lufico": ["Lufico"], "Quélo": ["Quélo"], "Serra De Canda": ["Serra De Canda"], "Quindeje": ["Quibala - Norte", "Quindeje"]
        }}
    }`;

    // Tabela de Capitais
    const CAPITAIS_PROVINCIAS = {
        "Bengo": "Caxito", "Benguela": "Benguela", "Bié": "Cuito", "Cabinda": "Cabinda",
        "Cuando": "Mavinga", "Cubango": "Menongue",
        "Cuanza Norte": "Ndalatando", "Cuanza Sul": "Sumbe", "Cunene": "Ondjiva",
        "Huambo": "Huambo", "Huíla": "Lubango", 
        "Ícolo E Bengo": "Catete", 
        "Luanda": "Luanda",
        "Lunda Norte": "Dundo", "Lunda Sul": "Saurimo", "Malanje": "Malanje", 
        "Moxico": "Luena", "Moxico Leste": "Cazombo", 
        "Namibe": "Moçâmedes", "Uíge": "Uíge", "Zaire": "Mbanza Congo" 
    };

    // Coordenadas para o Mapa
    const PROVINCE_COORDINATES = {
        "Angola": { lat: -12.5, lon: 18.5, zoom: 5.5, label: "Angola" },
        "Bengo": { lat: -8.5833, lon: 14.2833, zoom: 9, label: "Caxito" },
        "Benguela": { lat: -12.5768, lon: 13.4079, zoom: 10, label: "Benguela" },
        "Bié": { lat: -12.4333, lon: 16.9333, zoom: 8, label: "Cuito" },
        "Cabinda": { lat: -5.5833, lon: 12.1833, zoom: 9, label: "Cabinda" },
        "Cuando": { lat: -15.4243, lon: 18.2758, zoom: 8, label: "Mavinga" }, 
        "Cubango": { lat: -14.6592, lon: 17.6881, zoom: 8, label: "Menongue" }, 
        "Cuanza Norte": { lat: -9.3000, lon: 14.9167, zoom: 9, label: "Ndalatando" },
        "Cuanza Sul": { lat: -11.2000, lon: 13.8447, zoom: 8, label: "Sumbe" },
        "Cunene": { lat: -17.0667, lon: 15.7333, zoom: 8, label: "Ondjiva" },
        "Huambo": { lat: -12.7833, lon: 15.7333, zoom: 10, label: "Huambo" },
        "Huíla": { lat: -14.9167, lon: 13.5000, zoom: 8.5, label: "Lubango" },
        "Ícolo E Bengo": { lat: -9.0000, lon: 13.6333, zoom: 10, label: "Catete" },
        "Luanda": { lat: -8.8383, lon: 13.2344, zoom: 11, label: "Luanda" },
        "Lunda Norte": { lat: -7.3500, lon: 20.8333, zoom: 8, label: "Dundo" },
        "Lunda Sul": { lat: -9.6667, lon: 20.3956, zoom: 8, label: "Saurimo" },
        "Malanje": { lat: -9.5333, lon: 16.3333, zoom: 8.5, label: "Malanje" },
        "Moxico": { lat: -11.7833, lon: 19.9167, zoom: 8, label: "Luena" },
        "Moxico Leste": { lat: -11.9500, lon: 22.8833, zoom: 8.5, label: "Cazombo" },
        "Namibe": { lat: -15.2057, lon: 12.1524, zoom: 9.5, label: "Moçâmedes" },
        "Uíge": { lat: -7.6000, lon: 15.0333, zoom: 9, label: "Uíge" },
        "Zaire": { lat: -6.2833, lon: 14.2500, zoom: 8.5, label: "Mbanza Congo" }
    };
    
    // Variáveis Globais
    let DPA_OFFICIAL = {};
    let map = null;
    let marker = null;

    const selectProvincia = document.getElementById('provincia');
    const selectMunicipio = document.getElementById('municipio');
    const selectComuna = document.getElementById('comuna');
    const statusDisplay = document.getElementById('status-display');
    
    // ----------------------------------------------------------------------
    // 1. INICIALIZAÇÃO DO MAPA
    // ----------------------------------------------------------------------
    function initMap() {
        const angolaCenter = PROVINCE_COORDINATES["Angola"];
        map = L.map('map').setView([angolaCenter.lat, angolaCenter.lon], angolaCenter.zoom);

        // Provedor CartoDB
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
            maxZoom: 18,
            attribution: '© OpenStreetMap contributors, © CartoDB'
        }).addTo(map);
    }
    
    // ----------------------------------------------------------------------
    // 2. LÓGICA DO MAPA (MOVIMENTO)
    // ----------------------------------------------------------------------
    function updateMap(provincia, municipio = null, comuna = null) {
        let coords, label, zoomLevel;
        
        if (provincia && PROVINCE_COORDINATES[provincia]) {
            coords = PROVINCE_COORDINATES[provincia];
            label = `Província de ${provincia}`;
            zoomLevel = coords.zoom || 9; 
            
            if (municipio) {
                zoomLevel = 11; 
                label = `Município de ${municipio} (${provincia})`;
            }
            if (comuna) {
                zoomLevel = 13; 
                label = `Comuna de ${comuna} (${municipio}, ${provincia})`;
            }
        } else {
            coords = PROVINCE_COORDINATES["Angola"];
            label = "Angola";
            zoomLevel = coords.zoom;
        }

        if (coords) {
            map.flyTo([coords.lat, coords.lon], zoomLevel, { duration: 1.5 });
            
            if (marker) {
                map.removeLayer(marker);
            }
            marker = L.marker([coords.lat, coords.lon]).addTo(map)
                .bindPopup(`<b>${label}</b>`).openPopup();
        }
    }
    
    // ----------------------------------------------------------------------
    // 3. LÓGICA DO SELETOR
    // ----------------------------------------------------------------------

    function popularProvincias() {
        selectProvincia.innerHTML = '<option value="">Selecione a Província</option>'; 
        if (Object.keys(DPA_OFFICIAL).length === 0) return;

        const provincias = Object.keys(DPA_OFFICIAL).sort(); 
        provincias.forEach(nome => {
            const option = document.createElement('option');
            option.value = nome;
            option.textContent = nome;
            selectProvincia.appendChild(option);
        });
        statusDisplay.className = 'status-box';
        statusDisplay.innerHTML = `<p><strong>SUCESSO:</strong> Foram carregadas ${provincias.length} Províncias (21 DPA). Selecione uma.</p>`;
    }

    function popularMunicipios(provincia) {
        selectMunicipio.innerHTML = '<option value="">Selecione o Município</option>';
        selectComuna.innerHTML = '<option value="">Selecione a Comuna</option>';
        selectComuna.disabled = true;

        if (provincia && DPA_OFFICIAL[provincia]) {
            const municipios = DPA_OFFICIAL[provincia].Municipios;
            Object.keys(municipios).sort().forEach(nome => {
                const option = document.createElement('option');
                option.value = nome;
                option.textContent = nome;
                selectMunicipio.appendChild(option);
            });
            selectMunicipio.disabled = false;
        } else {
            selectMunicipio.disabled = true;
        }
    }

    function popularComunas(provincia, municipio) {
        selectComuna.innerHTML = '<option value="">Selecione a Comuna</option>';

        if (provincia && municipio && DPA_OFFICIAL[provincia].Municipios[municipio]) {
            const comunas = DPA_OFFICIAL[provincia].Municipios[municipio];
            comunas.sort().forEach(nome => {
                const option = document.createElement('option');
                option.value = nome;
                // As comunas são carregadas diretamente do JSON, que já tem o Title Case
                option.textContent = nome; 
                selectComuna.appendChild(option);
            });
            selectComuna.disabled = comunas.length === 0;
        } else {
            selectComuna.disabled = true;
        }
    }

    function atualizarStatus(provincia, municipio = null, comuna = null) {
        if (!provincia) {
            statusDisplay.innerHTML = '<p>Selecione uma **Província** no menu acima.</p>';
            updateMap(null); 
            return;
        }

        const capital = CAPITAIS_PROVINCIAS[provincia] || "Não Definida";
        
        // Os nomes são usados diretamente do JSON (Title Case)
        let localizacao = `<strong>Província:</strong> ${provincia}<br><span class="capital">Capital: ${capital}</span>`;
        let nivel = 'Província';

        if (municipio) {
            localizacao += `<br><strong>Município:</strong> ${municipio}`;
            nivel = 'Município';
        }
        if (comuna) {
            localizacao += `<br><strong>Comuna:</strong> ${comuna}`;
            nivel = 'Comuna';
        }
        
        statusDisplay.innerHTML = `<p><strong>Nível Selecionado:</strong> ${nivel}</p><p>${localizacao}</p>`;
        
        updateMap(provincia, municipio, comuna);
    }

    // Eventos 
    function eventProvincia(event) {
        const selectedProvincia = event.target.value;
        popularMunicipios(selectedProvincia);
        // Reset da Comuna
        selectComuna.innerHTML = '<option value="">Selecione a Comuna</option>';
        selectComuna.disabled = true;
        atualizarStatus(selectedProvincia); 
    }

    function eventMunicipio(event) {
        const selectedProvincia = selectProvincia.value;
        const selectedMunicipio = event.target.value;
        popularComunas(selectedProvincia, selectedMunicipio);
        atualizarStatus(selectedProvincia, selectedMunicipio);
    }
    
    function eventComuna(event) {
        const selectedProvincia = selectProvincia.value;
        const selectedMunicipio = selectMunicipio.value;
        const selectedComuna = event.target.value;
        
        atualizarStatus(selectedProvincia, selectedMunicipio, selectedComuna);
    }

    // ****************************************************
    // INICIALIZAÇÃO ROBUSTA
    // ****************************************************
    (function() {
        try {
            // 1. Tenta carregar os dados JSON
            DPA_OFFICIAL = JSON.parse(DPA_JSON_STRING);

            // 2. Inicialização do mapa e dos seletores
            initMap(); 
            popularProvincias();
            
            // 3. Atribuição de Event Listeners
            selectProvincia.addEventListener('change', eventProvincia);
            selectMunicipio.addEventListener('change', eventMunicipio);
            selectComuna.addEventListener('change', eventComuna);
            
        } catch (e) {
            // Se falhar, mostra erro na caixa de status e na consola
            statusDisplay.innerHTML = `<p><strong>ERRO CRÍTICO (JS):</strong> Falha na execução do código. O JSON não pôde ser lido. Consulte a consola (F12).</p><p>Detalhe do Erro: ${e.message}</p>`;
            // Mudar a classe para destacar o erro
            statusDisplay.style.borderColor = 'red';
            statusDisplay.style.backgroundColor = '#ffe6e6';
            console.error("ERRO FATAL NA EXECUÇÃO DO SCRIPT:", e);
        }
    })();
    
</script>

</body>
</html>
